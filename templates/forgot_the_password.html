<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Восстановление пароля - TechStore</title>

    <link rel="stylesheet" href="/static/forgot_the_password.css">
    <link rel="stylesheet" href="/static/notifications.css">
</head>
<body>
    <div class="password-container">
        <div class="password-card">
            <div class="password-header">
                <a href="/login" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <div class="logo"  onclick="window.location.href='/autho'">Обратно</div>
                <h1>Восстановление пароля</h1>
            </div>

            <div class="password-body">
                <!-- Шаги процесса -->
                <div class="steps">
                    <div class="step active" id="step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Email</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Код</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Новый пароль</div>
                    </div>
                </div>

                <!-- Сообщения -->
                <div class="message info" id="infoMessage">
                    <i class="fas fa-info-circle"></i>
                    <span id="infoText">Введите email, указанный при регистрации</span>
                </div>

                <div class="message error" id="errorMessage">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="errorText"></span>
                </div>

                <div class="message success" id="successMessage">
                    <i class="fas fa-check-circle"></i>
                    <span id="successText"></span>
                </div>

              <div id="step1Content" class="step-content fade-in">
    <!-- УБИРАЕМ ФОРМУ и делаем просто div -->
    <div>
        <div class="form-group">
            <label for="email">Электронная почта</label>
            <div class="input-with-icon">
                <i class="fas fa-envelope"></i>
                <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="your@email.com"
                    required
                >
            </div>
        </div>

        <button type="button" class="password-btn" id="sendCodeBtn" onclick="CodeTo(event)">
            <i class="fas fa-paper-plane"></i>
            Отправить код
        </button>
    </div>
</div>

                <!-- Шаг 2: Ввод кода подтверждения -->
                <div id="step2Content" class="step-content" style="display: none;">
                    <form id="codeForm">
                        <div class="form-group">
                            <label>Код подтверждения</label>
                            <div class="code-inputs">
                                <input type="text" class="code-input" maxlength="1" data-index="0">
                                <input type="text" class="code-input" maxlength="1" data-index="1">
                                <input type="text" class="code-input" maxlength="1" data-index="2">
                                <input type="text" class="code-input" maxlength="1" data-index="3">
                                <input type="text" class="code-input" maxlength="1" data-index="4">
                                <input type="text" class="code-input" maxlength="1" data-index="5">
                            </div>
                            <input type="hidden" id="verificationCode">

                            <div class="resend-code">
                                <div class="timer" id="timer">Отправить код повторно через: 60 сек</div>
                                <a href="#" id="resendLink" style="display: none;" onclick="resendCode()">Отправить код повторно</a>
                            </div>
                        </div>

                        <button type="submit" class="password-btn" id="verifyCodeBtn" onclick="CodeCheck(event)">
                            <i class="fas fa-check"></i>
                            Подтвердить код
                        </button>
                    </form>
                </div>

                <!-- Шаг 3: Ввод нового пароля -->
                <div id="step3Content" class="step-content" style="display: none;">
                    <form id="passwordForm">
                        <div class="form-group">
                            <label for="newPassword">Новый пароль</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input
                                    type="password"
                                    id="newPassword"
                                    name="newPassword"
                                    placeholder="Введите новый пароль"
                                    required
                                >
                            </div>
                            <div class="password-strength" id="passwordStrength">
                                <div class="strength-bar">
                                    <div class="strength-fill"></div>
                                </div>
                                <div class="strength-text">Надежность пароля: слабый</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="confirmPassword">Подтвердите пароль</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input
                                    type="password"
                                    id="confirmPassword"
                                    name="confirmPassword"
                                    placeholder="Повторите новый пароль"
                                    required
                                >
                            </div>
                        </div>

                        <button type="submit" class="password-btn" id="resetPasswordBtn" onclick="NewPassword(event)">
                            <i class="fas fa-key"></i>
                            Установить новый пароль
                        </button>
                    </form>
                </div>

                <div class="login-link">
                    Вспомнили пароль? <a href="/login">Войти в аккаунт</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Элементы DOM
        const emailForm = document.getElementById('emailForm');
        const codeForm = document.getElementById('codeForm');
        const passwordForm = document.getElementById('passwordForm');
        const emailInput = document.getElementById('email');
        const codeInputs = document.querySelectorAll('.code-input');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const verificationCodeInput = document.getElementById('verificationCode');
        const sendCodeBtn = document.getElementById('sendCodeBtn');
        const verifyCodeBtn = document.getElementById('verifyCodeBtn');
        const resetPasswordBtn = document.getElementById('resetPasswordBtn');
        const infoMessage = document.getElementById('infoMessage');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const infoText = document.getElementById('infoText');
        const errorText = document.getElementById('errorText');
        const successText = document.getElementById('successText');
        const timerElement = document.getElementById('timer');
        const resendLink = document.getElementById('resendLink');
        const passwordStrength = document.getElementById('passwordStrength');

        let currentStep = 1;
        let generatedCode = '';
        let timerInterval;

        // Показать сообщение
        function showMessage(type, text) {
            infoMessage.classList.remove('show');
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');

            if (type === 'info') {
                infoText.textContent = text;
                infoMessage.classList.add('show');
            } else if (type === 'error') {
                errorText.textContent = text;
                errorMessage.classList.add('show');
                document.querySelector('.step-content').classList.add('shake');
                setTimeout(() => document.querySelector('.step-content').classList.remove('shake'), 300);
            } else if (type === 'success') {
                successText.textContent = text;
                successMessage.classList.add('show');
            }
        }

        // Переход к следующему шагу
        function goToStep(step) {
            // Скрыть все шаги
            document.querySelectorAll('.step-content').forEach(content => {
                content.style.display = 'none';
            });

            // Сбросить активные шаги
            document.querySelectorAll('.step').forEach(stepEl => {
                stepEl.classList.remove('active', 'completed');
            });

            // Активировать текущий и предыдущие шаги
            for (let i = 1; i <= step; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (i === step) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.add('completed');
                }
            }

            // Показать текущий шаг
            document.getElementById(`step${step}Content`).style.display = 'block';
            document.getElementById(`step${step}Content`).classList.add('fade-in');

            currentStep = step;

            // Обновить информационное сообщение
            updateInfoMessage();
        }

        // Обновить информационное сообщение
        function updateInfoMessage() {
            const messages = {
                1: 'Введите email, указанный при регистрации',
                2: 'Введите 6-значный код, отправленный на вашу почту',
                3: 'Придумайте новый надежный пароль'
            };
            showMessage('info', messages[currentStep]);
        }

        // Генерация случайного кода
        function generateCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Запуск таймера для повторной отправки
        function startTimer(duration = 60) {
            let timeLeft = duration;
            resendLink.style.display = 'none';
            timerElement.style.display = 'block';

            timerInterval = setInterval(() => {
                timerElement.textContent = `Отправить код повторно через: ${timeLeft} сек`;
                timeLeft--;

                if (timeLeft < 0) {
                    clearInterval(timerInterval);
                    timerElement.style.display = 'none';
                    resendLink.style.display = 'block';
                }
            }, 1000);
        }

        // Проверка надежности пароля
        function checkPasswordStrength(password) {
            let strength = 0;
            const strengthBar = passwordStrength.querySelector('.strength-fill');
            const strengthText = passwordStrength.querySelector('.strength-text');

            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            passwordStrength.className = 'password-strength';
            strengthBar.style.width = '0%';

            if (password.length === 0) {
                strengthText.textContent = 'Надежность пароля: слабый';
                return;
            }

            if (strength <= 2) {
                passwordStrength.classList.add('strength-weak');
                strengthText.textContent = 'Надежность пароля: слабый';
            } else if (strength <= 4) {
                passwordStrength.classList.add('strength-medium');
                strengthText.textContent = 'Надежность пароля: средний';
            } else {
                passwordStrength.classList.add('strength-strong');
                strengthText.textContent = 'Надежность пароля: сильный';
            }
        }

        // Обработка ввода кода подтверждения
        codeInputs.forEach((input, index) => {
            input.addEventListener('input', function(e) {
                const value = e.target.value;

                // Переход к следующему полю
                if (value && index < codeInputs.length - 1) {
                    codeInputs[index + 1].focus();
                }

                // Проверка заполненности всех полей
                const allFilled = Array.from(codeInputs).every(input => input.value);
                verifyCodeBtn.disabled = !allFilled;

                // Обновление скрытого поля
                updateVerificationCode();
            });

            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    codeInputs[index - 1].focus();
                }
            });
        });

        function updateVerificationCode() {
            const code = Array.from(codeInputs).map(input => input.value).join('');
            verificationCodeInput.value = code;
        }






        // Повторная отправка кода
        function resendCode() {
            generatedCode = generateCode();
            console.log(`Новый код подтверждения: ${generatedCode}`);
            showMessage('success', 'Новый код отправлен на вашу почту');
            startTimer();
        }

        // Проверка email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Обработка изменения пароля
        newPasswordInput.addEventListener('input', function() {
            checkPasswordStrength(this.value);
        });

        // Имитация API запросов
        function simulateSendCode(email) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Демо-проверка существующих email
                    const existingEmails = ['demo@example.com', 'test@test.com', 'user@example.com'];
                    if (existingEmails.includes(email)) {
                        resolve({ success: true });
                    } else {
                        reject(new Error('Пользователь с таким email не найден'));
                    }
                }, 1500);
            });
        }

        function simulateVerifyCode(code) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (code === generatedCode) {
                        resolve({ success: true });
                    } else {
                        reject(new Error('Неверный код подтверждения'));
                    }
                }, 1000);
            });
        }

        function simulateResetPassword(password) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({ success: true });
                }, 1500);
            });
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            infoMessage.classList.add('show');

            // Демо-заполнение (можно убрать)
            emailInput.value = 'demo@example.com';
        });
    </script>

<script src="/static/forgotpasswordcode.js"></script>
</body>
</html>